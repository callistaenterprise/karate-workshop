# localhost-test-pki

This project is based
on [pki-for-development](https://callistaenterprise.se/blogg/teknik/2023/04/21/pki-for-development/).

## Purpose

This project builds a small, self-signed Public Key Infrastructure, to be used for development and test purposes. It
consists of a Root CA, a server certificate and a client certificate. Using these certificates, TLS and Mutual TLS
sessions can be established with proper trust between client and server.

### Root CA and truststore

The root CA private key `localCA.key` is only used to issue new certificates.
The root CA certificate `localCA.crt` is packaged into a truststore `truststore.jks` (and `truststore.p12` if PKCS12
format is required) to
be used as trust anchor for all other certificates.

### Server certificate and keystore

The server certificate `server.crt` is issued for `localhost` but also has
`host.docker.internal` as alternate SAN, in order for it to be valid for use both locally and in local
docker environments. The server certificate and corresponding private key `server.key` are bundled into
keystores `server.jks` and `server.p12`.

### Client certificate and keystore

The client certificate `client.crt` have the CN `client`. The client certificate and corresponding private
key `client.key` are bundled into
keystores `client.jks` and `client.p12`.

## Generating certificates and keystores

The certificates are generated by the helper scripts in the `src/main/bash` folder. A prerequisite for running the build
is that `keytool` (from a JDK) and `openssl` are installed.

The certificates and keystores were generated by running the following commands:

`mvn package`

The end result is that the certificates and keystores are generated into
`src/main/resources/certs` if not already existing, and then packaged into
`target/localhost-test-pki-${project.version}.jar`

## Regenerating the certificates and keystores

If the certificates and keystores needs to be regenerated, run `mvn clean` to remove
`src/main/resources/certs`, then run `mvn package` to regenerate and package the new
certificates and keystores.
